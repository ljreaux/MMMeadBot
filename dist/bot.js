"use strict";var T=Object.create;var b=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var W=(e,n,s,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of U(n))!I.call(e,o)&&o!==s&&b(e,o,{get:()=>n[o],enumerable:!(r=P(n,o))||r.enumerable});return e};var m=(e,n,s)=>(s=e!=null?T(G(e)):{},W(n||!e||!e.__esModule?b(s,"default",{value:e,enumerable:!0}):s,e));var d=require("discord.js"),N=m(require("dotenv"));var w=m(require("mongoose")),k=m(require("dotenv"));k.default.config();var C=process.env.MONGO_URI,c=global.mongoose;async function Y(){if(!C)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(c||(c=global.mongoose={conn:null,promise:null}),c.conn)return c.conn;if(!c.promise){let e={bufferCommands:!1};c.promise=w.default.connect(C,e).then(n=>(console.log("Db connected"),n))}try{c.conn=await c.promise}catch(e){throw c.promise=null,e}return c.conn}var y=Y;var p=m(require("mongoose")),q=new p.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),v=p.default.models.Command||p.default.model("Command",q);var f=m(require("mongoose")),D=new f.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),L=f.default.models.Recipe||f.default.model("Recipe",D);var g=async()=>await L.find(),$=async(e,n)=>{let s=await g(),[,r]=e.split(" ");if(!r)return;let o=r?.toLowerCase()||"",a=s.find(t=>t.name===o);if(a){n.channel.send(a.link);return}else if(r){n.channel.send(`The recipe ${r} is not a valid recipe command.`);return}};var z=["Beginner","10 Meads","20 Meads","25 Meads","30 Meads","40 Meads","50 Meads","75 Meads","100 Meads"],F=z.reduce((e,n)=>`${e}
- ${n}`),V=async()=>await v.find(),h="?rank ",R=e=>{let n=!1;return["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"].forEach(r=>{(r.toLowerCase()===e.toLowerCase()||r.toLowerCase().includes(e.toLowerCase()))&&(n=!0)}),n},x=async(e,n)=>{let s=await g(),r=await V(),o=s.map(t=>t.name).reduce((t,i)=>`${t}
- ${i}`);for(let t of r){if(e.includes("!recipes "))return;(t.command===e||e.startsWith(t.command))&&(e.toLowerCase().startsWith("!listranks")&&(t.response+=` 
- ${F}`),e==="!recipes"&&(t.response+=` 
- ${o}`),n.channel.send(t.response).catch(i=>console.error(i)))}let a=t=>{let i=[];return i=t.map(l=>`${l.command}
`),i.push("!abv"),i};if(e=="!list"){let t=`
**Available Bot Commands**
`,i=a(r),E=`${t}${i}`.replaceAll(",","");n.channel.send(E).catch(O=>console.error(O))}};var _=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,H=(e,n)=>{let s=-668.962+1262.45*e-776.43*e**2+182.94*e**3,r=-668.962+1262.45*n-776.43*n**2+182.94*n**3,o=.22+.001*s,a=(o*s+r)/(1+o),t=(s-a)/(2.0665-.010665*s),i=Math.round(t*(n/.794)*100)/100;return[Math.round(_(n)+4.5*i),i]},B=(e,n)=>{let[,s,r]=e.split(" "),[o,a]=[Number(s),Number(r)||.996];if(isNaN(o)||isNaN(a)||o<a||o>1.22||a>1.22||o-a>.165){n.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");return}let[i,l]=H(o,a);n.channel.send(`An OG of ${o.toFixed(3)} and an FG of ${a.toFixed(3)} will make ${l}% ABV and ${i} delle units.`)};var M=require("discord.js"),A=(e,n)=>{let s=n.includes("kick")?"kick":"ban";if(!(e.member?.permissionsIn(e.channel.id).has(M.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(M.PermissionsBitField.Flags.ModerateMembers))){e.channel.send("Nice try, but you don't have the power");return}let[,r]=n.split(" ");if(!r){e.channel.send(`You need to specify a user to ${s}.`);return}let o=e.mentions.users.first();if(!o){e.channel.send("User not found.");return}s==="kick"?e.guild?.members.kick(o):e.guild?.members.ban(o),e.channel.send(`${o.tag} has been ${s}ed.`)};var S=(e,n,s)=>{let r=s?.roles.cache.filter(t=>t.name.toLowerCase().includes("mead")||t.name.toLowerCase()==="beginner"),o=e.substring(h.length);if(o.toLowerCase().includes("every")||o.toLowerCase().includes("@")){n.channel.send("Nice try. No ping for you.");return}if(R(o)){n.channel.send(`You are in this discord server, but we do not grant you the rank of ${o}`);return}let a=n.guild?.roles.cache.find(t=>(o==="10"&&(o="10 "),o.length===1&&(o+=" "),t.name.toLowerCase()===o.toLowerCase()||t.name.toLowerCase().startsWith(o.toLowerCase())));if(!a){n.channel.send(`The role ${o} is not a valid role.`);return}r?.forEach(t=>s?.roles.remove(t.id)),s?.roles.add(a.id),n.channel.send(`You have been assigned to role "${a.name}"`).catch(t=>console.error(t))};N.default.config();var{token:j,welcomeChannel:K="",botSpamChannel:J="",generalChannel:Q=""}=process.env,u=new d.Client({intents:[d.GatewayIntentBits.Guilds,d.GatewayIntentBits.GuildMessages,d.GatewayIntentBits.MessageContent,d.GatewayIntentBits.GuildMembers,d.GatewayIntentBits.GuildPresences]});u.login(j);u.once(d.Events.ClientReady,async e=>{await y(),console.log(`Ready! Logged in as ${e.user.tag}`)});u.on("messageCreate",e=>{if(e.author.bot)return;let n=e.content,{member:s}=e,r=o=>n.toLowerCase().startsWith(o);if(r("?kick")||r("?ban"))return A(e,n);if(r(h))return S(n,e,s);if(r("!recipes")&&$(n,e),r("!abv"))return B(n,e);if(r("!flip")){e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}");return}if(r("!bakingsoda")){e.channel.send("Baking soda is not a mead ingredient!!");return}return x(n,e)});u.on("guildMemberAdd",e=>{u.channels.cache.get(K).send(`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${J}> and run **?rank (rank)** to receive a rank and join your mini mead making community.

Hop on into <#${Q}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`)});
