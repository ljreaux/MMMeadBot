"use strict";var Se=Object.create;var O=Object.defineProperty;var Ue=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Le=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var Be=(e,n,o,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of Ne(n))!Ie.call(e,t)&&t!==o&&O(e,t,{get:()=>n[t],enumerable:!(r=Ue(n,t))||r.enumerable});return e};var u=(e,n,o)=>(o=e!=null?Se(Le(e)):{},Be(n||!e||!e.__esModule?O(o,"default",{value:e,enumerable:!0}):o,e));Array.prototype.groupBy||(Array.prototype.groupBy=function(e){return this.reduce((n,o)=>{let r=e(o);return n[r]||(n[r]=[]),n[r].push(o),n},{})});var p=require("discord.js"),Te=u(require("dotenv"));var H=u(require("mongoose")),W=u(require("dotenv"));W.default.config();var Y=process.env.MONGO_URI,h=global.mongoose;async function _e(){if(!Y)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(h||(h=global.mongoose={conn:null,promise:null}),h.conn)return h.conn;if(!h.promise){let e={bufferCommands:!1};h.promise=H.default.connect(Y,e).then(n=>(console.log("Db connected"),n))}try{h.conn=await h.promise}catch(e){throw h.promise=null,e}return h.conn}var F=_e;var M=u(require("mongoose")),Ve=new M.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),q=M.default.models.Command||M.default.model("Command",Ve);var k=u(require("mongoose")),Ee=new k.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),G=k.default.models.Recipe||k.default.model("Recipe",Ee);var L=async()=>await G.find(),K=async e=>{let n=await L(),o=e.content,[,r]=o.split(" ");if(!r)return;let t=r?.toLowerCase()||"",a=n.find(i=>i.name===t);if(a){e.channel.send(a.link);return}else if(r){e.channel.send(`The recipe ${r} is not a valid recipe command.`);return}};var De=async()=>await q.find(),z=async(e,n)=>{let t=(n?.guild?.roles.cache.filter(s=>s.name.toLowerCase().includes("meads")||s.name.toLowerCase()==="beginner")?.map(s=>s.name).sort((s,d)=>{let m=/^\d+/.test(s),y=/^\d+/.test(d);if(m&&y){let N=parseInt(s.match(/^\d+/)[0],10),$e=parseInt(d.match(/^\d+/)[0],10);return N-$e}else return m?1:y?-1:s.localeCompare(d)})||[]).reduce((s,d)=>`${s}
- ${d}`),a=await L(),i=await De(),c=a.map(s=>s.name).reduce((s,d)=>`${s}
- ${d}`);for(let s of i){if(e.includes("!recipes ")||e.includes("!video "))return;e.startsWith(s.command)&&(e.toLowerCase().startsWith("!listranks")&&(s.response+=` 
- ${t}`),e==="!recipes"&&(s.response+=` 
- ${c}`),n.channel.send(s.response).catch(d=>console.error(d)))}let l=s=>{let d=s.map(m=>`${m.command}
`);return d.push("!abv"),d};if(e=="!list"){let s=`
**Available Bot Commands**
`,d=l(i),y=`${s}${d}`.replaceAll(",","");return n.channel.send(y).catch(N=>console.error(N))}};var I="?rank ",X="1322772543962349670",je=["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rhythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"],Pe=e=>{for(let n of je)if(n.toLowerCase().startsWith(e.toLowerCase()))return!0;return!1},Oe={10:"Whew, you\u2019re on fire! Congratulations on your 10th mead!",20:"Congratulations on your 20th mead! What was it?",30:"You\u2019ve made it to 30 meads. Have you made the same mead twice yet?",40:"40 meads, that\u2019s impressive! Which batch has been your favorite so far?",50:"Halfway to 100! Congrats on your 50th mead! Any plans for a celebratory brew?",60:"60 meads? You\u2019re practically a mead master at this point! What have you learned along the way?",70:"70 meads, wow! You\u2019re truly hitting your stride. Have you ventured into any new flavors or techniques?",80:"80 meads! Are you experimenting more with ingredients now, or are you perfecting your go-to recipe?",90:"90 meads and still going strong! Do you feel like you\u2019ve found your signature flavor yet?",100:"100 meads, what an accomplishment! Celebrate with something extra special. What\u2019s next?",125:"125 meads, that\u2019s incredible! How have your brewing skills evolved over time?",150:"150 meads\u2014wow! You\u2019ve officially entered the legendary ranks. What\u2019s the most memorable batch so far?",175:"175 meads! Have you started sharing your knowledge with others yet, or keeping it all to yourself?",200:"200 meads! That\u2019s a serious milestone! What do you consider your greatest brewing achievement?",225:"225 meads, that\u2019s amazing! Are you starting to experiment with aging techniques or larger batches?",250:"250 meads, you\u2019re a true mead-making pro! What new challenges are you setting for yourself?",275:"275 meads! You\u2019re practically a mead-making institution by now! Any plans for collaborations or competitions?",300:"300 meads\u2014what an accomplishment! Are you thinking about branching into commercial production?",325:"325 meads! That\u2019s dedication. What\u2019s your strategy for keeping things fresh and exciting with every batch?",350:"350 meads\u2014so impressive! Have you started documenting your brews in a more formal way, like a mead book or blog?",375:"375 meads! You\u2019re truly a mead-making legend. Do you have a personal favorite recipe that you keep coming back to?",400:"400 meads! A monumental achievement. Do you feel like you've mastered the craft, or is there still more to learn?",425:"425 meads, wow! What\u2019s your next big goal in your mead-making journey?",450:"450 meads! Absolutely incredible. Are you planning any big celebrations or milestones for the 500 mark?"},J={69:`Nice
||Still not a valid role though.||`,420:"Nice try. This isn\u2019t *that* kind of server."},Ye="Welcome to the world of mead-making! Start your journey with your first brew!",He="Keep brewing! Every batch is a step closer to mastery!",Z=async(e,n,o)=>{let r=o?.roles.cache.filter(s=>s.name.toLowerCase().includes("meads")||s.name.toLowerCase()==="beginner"),t=e.substring(I.length).trim();if(t.toLowerCase().includes("every")||t.toLowerCase().includes("@"))return n.channel.send("Nice try. No ping for you.");if(Pe(t))return n.channel.send(`You are in this discord server, but we do not grant you the rank of ${t}`);if(t.toLowerCase()==="beginner"){let s=n.guild?.roles.cache.find(m=>m.name.toLowerCase()==="beginner");return s?(r?.forEach(m=>o?.roles.remove(m.id)),o?.roles.add(s.id),n.guild?.channels.cache.get(X)?.send(`${n.author.toString()} ${Ye}`).catch(m=>console.error(m)),n.channel.send('You have been assigned to the "Beginner" role.').catch(m=>console.error(m))):n.channel.send('The role "Beginner" is not available.')}t=t.replace(/meads?/i,"").trim();let a=parseInt(t,10);if(isNaN(a))return n.channel.send(`The rank "${t}" is not a valid format (e.g., "10" or "10 meads").`);let i=n.guild?.roles.cache.find(s=>{let d=s.name.match(/^(\d+)\s*Meads?$/i);return(d?parseInt(d[1],10):null)===a});if(!i)return J[a]?n.channel.send(J[a]):n.channel.send(`The role "${t}" is not a valid role.`);r?.forEach(s=>o?.roles.remove(s.id)),o?.roles.add(i.id);let c=n.guild?.channels.cache.get(X),l=Oe[a];return l||(l=He),c?.send(`${n.author.toString()} ${l}`).catch(s=>console.error(s)),n.channel.send(`You have been assigned to role "${i.name}"`).catch(s=>console.error(s))};var x=u(require("mongoose")),We=new x.default.Schema({discordId:{type:String,required:!0},joinedAt:{type:Date,required:!0}}),C=x.default.models.User||x.default.model("User",We);var Q=process.env.NEW_USER_ROLE||"",Fe=process.env.guildId||"";async function ee(e){let n=new Date,o=e.id,t=await new C({discordId:o,joinedAt:n}).save();return e.roles.add(Q),{discordId:t.discordId,joinedAt:t.joinedAt,id:t.id}}async function ne(){return await C.find({}).then(n=>n.map(o=>({_id:o._id.toString(),discordId:o.discordId,joinedAt:o.joinedAt})))}async function te(e,n){if(e.length===0){console.log("No Users Found");return}let o=new Date().getTime(),t=1e3*60*60*24*7;e.forEach(a=>{o-a.joinedAt.getTime()>t&&(n.guilds.cache.get(Fe)?.members.cache.find(l=>l.id===a.discordId)?.roles.remove(Q),C.deleteOne({_id:a._id}).then(l=>console.log(l)),console.log(`Deleted user with discordId ${a.discordId}`))})}var v=u(require("node-cron"));var qe=/belly.*pickle|pickle.*belly|pelly|bickle|sbp|s\.b\.p|belly.*cucumber|cucumber.*belly|tummy.*pickle|pickle.*tummy|pouthern|bouthern/i,B=async e=>{if(qe.test(e.content))return e.channel.send(`${e.member?.user} You've been naughty. Stop that or go to jail. \u{1F46E} \u{1F693}`),await e.delete()};var se=require("discord.js"),ie=u(require("rss-parser"));var R=u(require("mongoose")),Ge=new R.default.Schema({video_id:{type:String,required:!0},created_at:{type:Date,required:!0}}),T=R.default.models.NewVideo||R.default.model("NewVideo",Ge);var Ke=new ie.default,{YOUTUBE_XML_URL:oe,youtubeShenanigans:re,guildId:ae}=process.env;async function _(e){try{if(!oe||!re||!ae)throw new Error;let o=await(await e.guilds.fetch(ae)).channels.fetch(re),r=await Ke.parseURL(oe),[t]=await T.find().lean(),a=t?.video_id||"",{id:i,title:c,link:l,author:s}=r.items[0];if(a!==i){await T.deleteMany({});let m=await(await T.create({created_at:new Date,video_id:i})).save();console.log("New video stored: ",m);let y=new se.EmbedBuilder({title:c,url:l,timestamp:Date.now(),image:{url:`https://img.youtube.com/vi/${i.slice(9)}/maxresdefault.jpg`},author:{name:s,iconURL:"https://yt3.googleusercontent.com/quhem18O3ZxjTxeHYD4B95wluihYXG5bmdUrY-dXD7-XrUwJUndGjpnys9H4lpA-W9Pzco51pkg=s160-c-k-c0x00ffffff-no-rj",url:"https://www.youtube.com/c/ManMadeMead/?sub_confirmation=1"},footer:{text:e.user?.tag||"",iconURL:e.user?.displayAvatarURL()||""}});await o?.send({embeds:[y]})}}catch(n){console.error("Error parsing RSS feed",n);return}}var{guildId:ce}=process.env;async function V(e){let n="251250155960008704",o="434942205426401322",r=" https://res.cloudinary.com/devhg2clt/video/upload/v1734387048/1734386607_1734386559268_80482C2B5BB4131734386559_by9g3y.mp4",{botSpamChannel:t=""}=process.env;try{if(!ce)throw new Error("Missing guildId in environment variables.");let a=await e.guilds.fetch(ce),i=e.channels.cache.get(t),c=Math.random(),s=`Hi, <@${c<.25?o:n}>`;c>.75&&(s+=r),await i.send(s)}catch(a){console.error("Error selecting or sending to a random channel",a);return}}var de=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,ze=(e,n)=>{let o=-668.962+1262.45*e-776.43*e**2+182.94*e**3,r=-668.962+1262.45*n-776.43*n**2+182.94*n**3,t=.22+.001*o,a=(t*o+r)/(1+t),i=(o-a)/(2.0665-.010665*o),c=Math.round(i*(n/.794)*100)/100;return[Math.round(de(n)+4.5*c),c]},le=e=>{let n=e.content,[,o,r]=n.split(" "),[t,a]=[Number(o),Number(r)||.996];if(isNaN(t)||isNaN(a)||t<a||t>1.22||a>1.22||t-a>.165)return e.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");let[c,l]=ze(t,a),s=`An OG of ${t.toFixed(3)} and an FG of ${a.toFixed(3)} will make ${l}% ABV and ${c} delle units.`;return e.channel.send(s)},me=e=>{let n=e.content,[,o,r]=n.split(" "),t=parseFloat(o),a=parseFloat(r);if(isNaN(t)||isNaN(a))return e.channel.send("Please enter a valid ABV and FG.");if(t>23)return e.channel.send("The ABV provided is too high.");let i=Math.round(de(a)+4.5*t),c=i>=73,l=`**${t.toFixed(2)}%** ABV and a final gravity of **${a.toFixed(3)}** will give you **${i} delle units**.
`,s=c?"Your brew is likely stable without chemical stabilizers.":"Your brew will need stabilizers to prevent refermentation.";return e.channel.send(l+s)};var j=require("discord.js");var A=u(require("mongoose")),Xe=new A.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),$=A.default.models.video||A.default.model("video",Xe);var E=u(require("fs")),S="https://cloudinary-dv10-api.vercel.app/api/list-media",U="https://shadowhive-api.vercel.app/api/list-media",b=async e=>{try{let n=await fetch(e);if(!n.ok)throw new Error(`Failed to fetch images: ${n.statusText}`);return(await n.json()).resources.filter(t=>t.secure_url).map(t=>t.secure_url)}catch(n){return console.error("Error fetching Cloudinary images:",n),[]}},w=async(e,n)=>{try{let o=e.join(`
`);E.default.writeFileSync(n,o),console.log(`Images written to ${n}`)}catch(o){console.error("Error writing to file:",o)}},Je=e=>{try{return E.default.readFileSync(e,"utf8").split(`
`)}catch(n){return console.error(n),[]}},D=async e=>{try{let n=Je(e);if(n.length)return n[Math.floor(Math.random()*n.length)];throw new Error("No images found in the Cloudinary folder.")}catch(n){return console.error(n),"No images available."}};var Ze=15,Qe=["@everyone","@here"],g=e=>e.member?.permissionsIn(e.channel.id).has(j.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(j.PermissionsBitField.Flags.ModerateMembers),P=e=>{let n=e.content,o=n.includes("kick")?"kick":"ban";if(!g(e))return e.channel.send("Nice try, but you don't have the power");let[,r]=n.split(" ");if(!r)return e.channel.send(`You need to specify a user to ${o}.`);let t=e.mentions.users.first();return t?(o==="kick"?e.guild?.members.kick(t):e.guild?.members.ban(t),e.channel.send(`${t.tag} has been ${o}ed.`)):e.channel.send("User not found.")},ue=e=>{let n=e.content.toLowerCase(),{member:o}=e;if(g(e))return!1;let r=(t,a)=>typeof t=="string"?a.includes(t):t.test(a);for(let t of Qe){let a=r(t,n);if(a)return o?.timeout(Ze*60*1e3),a}return!1},he=async e=>{if(!g(e))return e.channel.send("Nice try, but you don't have the power");let n=c=>e.client.channels.cache.get(c),[,o,...r]=e.content.split(/[ ,]+/),t=o.slice(2,o.length-1),a=n(t),i=r.join(" ").trim();a&&a.send(i)},en=async e=>{let{command:n,response:o}=e,t=await new $({command:n,response:o}).save();return{command:t.command,response:t.response,id:t._id.toString()}},pe=async e=>{if(!g(e))return e.channel.send("Nice try, but you don't have the power");let[,n]=e.content.split(" "),o=e.attachments.first();if(!o||!n)return e.channel.send("Please provide a video attachment and command name.");let r=o.url,t=`!video ${n}`;return await en({command:t,response:r})?e.channel.send(`${n} has been successfully added.`):e.channel.send("Something went wrong.")},fe=async e=>{if(!g(e))return e.channel.send("Nice try, but you don't have the power");let n=await b(S);return await w(n,"images.txt"),e.channel.send("DV10 file has been refreshed.")},ge=async e=>{if(!g(e))return e.channel.send("Nice try, but you don't have the power");let n=await b(U);return await w(n,"shadowhive.txt"),e.channel.send("Shadowhive file has been refreshed.")},ye=e=>{if(g(e))return e.channel.send("Here are all the admin commands:\n1. ?kick `@user`\n2. ?ban `@user`\n3. ?registerVideo `video name` (attach video to message)\n4. To send a message from the bot, enter the following separated by spaces:\n  - `@MMMeadBot`\n  - `#channel-name`\n  - Your Message\n5. To add new commands visit the [admin dashboard.](https://mmmeadbot-admin-dashboard.vercel.app/)\n6. To refresh the DV10 file, use the command:\n  - `!refreshDv10`\n   ")};var nn=async()=>await $.find(),be=async e=>{let n=await nn(),o=e.content,[,r]=o.split(" ");if(!r)return;let t=r?.toLowerCase()||"",a=n.find(i=>i.command.includes(t));return a?e.channel.send(a.response):e.channel.send(`The video ${r} is not a valid video command.`)};var we=["https://media.discordapp.net/attachments/568934729676488706/1250544810864148530/20240612_151713.jpg?ex=66f1cd1c&is=66f07b9c&hm=3d635d01f15e0522b2549b07d96f7c18e087a9bbb3d9d8782e1b170042eddb5c&=&format=webp&width=924&height=1232","https://media.discordapp.net/attachments/756322400890650635/1287570767675916341/20240922_202600.jpg?ex=66f20738&is=66f0b5b8&hm=a3997db24c2f3cdd6efdc18145b06ad095585b342ad7479ba5f298adeede61f0&=&format=webp&width=576&height=1232","https://cdn.discordapp.com/attachments/795860418056159244/1128472098604580995/20230605_113657.jpg?ex=66f1fd8a&is=66f0ac0a&hm=178a7995ee8333bf9908946a6dde17956a53c0987b506f86e5966a840b3624b2&","https://media.discordapp.net/attachments/568934729676488706/1250544810864148530/20240612_151713.jpg?ex=6722949c&is=6721431c&hm=39b52f65399074f44b7f64d7609fd602baaa5adef90cce23c9eed0525771e320&format=webp&width=924&height=1232&","https://media.discordapp.net/attachments/568934729676488706/1300924513919303843/20241029_214606.jpg?ex=67229bde&is=67214a5e&hm=b9ff518e9bab96d48245661c5c08a74134a8b1697bd4429d84a212dd9819450b&=&format=webp&width=1620&height=1216"],tn=()=>we[Math.floor(Math.random()*we.length)],ve=tn;var on="https://meadtools.com",rn=["nutes","nutrients","nuteCalc"].map(e=>({arg:e,link:"/nute-calc"})),an=["brix","estimated-og","bench-trials","sulfite","sorbate","refractometer-correction","temperature-correction","blending","priming-sugar"].map(e=>({arg:e,link:`/extra-calcs/${e}`})),sn=[...rn,...an,{arg:"stabilizers",link:"/stabilizers"},{arg:"abv",link:"/extra-calcs"},{arg:"brix",link:"/extra-calcs/brix"},{arg:"temp",link:"/extra-calcs/temperature-correction"},{arg:"refractometer",link:"/extra-calcs/refractometer-correction"},{arg:"estimatedOG",link:"/extra-calcs/estimated-og"},{arg:"trials",link:"/extra-calcs/bench-trials"},{arg:"priming",link:"/extra-calcs/priming-sugar"},{arg:"juice",link:"/juice"},{arg:"yeast",link:"/yeast"},{arg:"tutorial",link:"/tutorial"}].map(e=>({...e,link:`${on}${e.link}`})),Me=[...sn],ke=e=>{let n=`[Calculator](<https://meadtools.com/>)
[Video walkthrough](<https://youtube.com/playlist?list=PLK2MubdaaOrUaQnjvfsJnqJv3agRmd4oS&si=ZV0NCqxCioRmg9mq>)

Run the command again with an argument from the list to get a more specific link. 
Run \`!arglist\`  for a list of arguments
  `,[,o]=e.content.split(" "),r=Me.find(t=>o?.toLowerCase().startsWith(t.arg.toLowerCase()));return r?e.channel.send(r.link):e.channel.send(n)},xe=e=>{let n=Me.groupBy(r=>r.link),o=Object.entries(n).map(([r,t])=>{let a=r.split("/").pop()||"",i=t.map(c=>`- ${c.arg}`).join(`
`);return`**${a}**
${i}`}).join(`

`);e.channel.send(`Here are all the available arguments organized by URL path:

${o}`)};var{MEAD_MENTOR_ROLE_ID:cn=""}=process.env,dn=e=>{let o=e.guild?.roles.cache.get(cn)?.members?.map(r=>r.displayName).reduce((r,t)=>r+=`- ${t}
`,`
`);if(!o)return e.channel.send("No mead mentors found.");e.channel.send(`The current Mead Mentors: ${o}`)},Ce=dn;var Re=[{command:"?kick",func:P},{command:"?ban",func:P},{command:"!recipes",func:K},{command:"!video",func:be},{command:"!abv",func:le},{command:"!delle",func:me},{command:"?registerVideo",func:pe},{command:"!refreshImages",func:fe},{command:"!refreshShadowHive",func:ge},{command:"!adminlist",func:ye},{command:"!meadtools",func:ke},{command:"!arglist",func:xe},{command:"!mentorlist",func:Ce},{command:"!flip",func:e=>e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}")},{command:"!bakingsoda",func:e=>e.channel.send("Baking soda is not a mead ingredient!!")},{command:"!avocadohoney",func:e=>e.channel.send(ve())},{command:"!dv10",func:async e=>e.channel.send(await D("images.txt"))},{command:"!shadowhive",func:async e=>e.channel.send(await D("shadowhive.txt"))}];Te.default.config();var{token:ln,clientId:mn,welcomeChannel:un="",botSpamChannel:hn="",generalChannel:pn="",adminChannel:fn=""}=process.env,f=new p.Client({intents:[p.GatewayIntentBits.Guilds,p.GatewayIntentBits.GuildMessages,p.GatewayIntentBits.MessageContent,p.GatewayIntentBits.GuildMembers,p.GatewayIntentBits.GuildPresences]}),Ae=e=>f.channels.cache.get(e),gn=Ae(fn);v.default.schedule("0 2 * * *",async()=>{let e=await ne();await te(e,f)});v.default.schedule("*/5 * * * *",async()=>await _(f));v.default.schedule("0 * * * *",async()=>{Math.random()*50<=1&&V(f)});v.default.schedule("0 0 * * 0",async()=>{let e=await b(S),n=await b(U);await w(e,"images.txt"),await w(n,"shadowhive.txt"),console.log("Image links saved successfully.")});f.login(ln);f.once(p.Events.ClientReady,async e=>{await F(),console.log(`Ready! Logged in as ${e.user.tag}`)});f.on("messageCreate",async e=>{if(e.author.bot)return;B(e);let n=e.content,{member:o}=e,r=i=>n.toLowerCase().startsWith(i.toLowerCase());r(`<@${mn}>`)&&he(e);let t=ue(e),a=`
<@&713811216979591282>
User ${o?.user} has been flagged for suspicious activity. They have been timed out for 15min. 
Suspicious content can be viewed here ${e.url}`;return t?gn.send(a):(Re.forEach(({command:i,func:c})=>{if(r(i))return c(e)}),r(I)||r("!rank")?Z(n,e,o):z(n,e))});f.on("messageUpdate",(e,n)=>B(n));f.on("guildMemberAdd",e=>{ee(e);let n=Ae(un),o=`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${hn}> and run **?rank (rank)** to receive a rank.

Hop on into <#${pn}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`;n.send(o)});
