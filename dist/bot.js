"use strict";var J=Object.create;var x=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty;var ne=(e,n,t,r)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of X(n))!ee.call(e,o)&&o!==t&&x(e,o,{get:()=>n[o],enumerable:!(r=Q(n,o))||r.enumerable});return e};var u=(e,n,t)=>(t=e!=null?J(Z(e)):{},ne(n||!e||!e.__esModule?x(t,"default",{value:e,enumerable:!0}):t,e));var d=require("discord.js"),F=u(require("dotenv"));var $=u(require("mongoose")),S=u(require("dotenv"));S.default.config();var R=process.env.MONGO_URI,c=global.mongoose;async function oe(){if(!R)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(c||(c=global.mongoose={conn:null,promise:null}),c.conn)return c.conn;if(!c.promise){let e={bufferCommands:!1};c.promise=$.default.connect(R,e).then(n=>(console.log("Db connected"),n))}try{c.conn=await c.promise}catch(e){throw c.promise=null,e}return c.conn}var T=oe;var h=u(require("mongoose")),te=new h.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),L=h.default.models.Command||h.default.model("Command",te);var f=u(require("mongoose")),re=new f.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),A=f.default.models.Recipe||f.default.model("Recipe",re);var b=async()=>await A.find(),U=async(e,n)=>{let t=await b(),[,r]=e.split(" ");if(!r)return;let o=r?.toLowerCase()||"",s=t.find(i=>i.name===o);if(s){n.channel.send(s.link);return}else if(r){n.channel.send(`The recipe ${r} is not a valid recipe command.`);return}};var se=["Beginner","10 Meads","20 Meads","25 Meads","30 Meads","40 Meads","50 Meads","75 Meads","100 Meads"],ie=se.reduce((e,n)=>`${e}
- ${n}`),ae=async()=>await L.find(),g="?rank ",B=e=>{let n=!1;return["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"].forEach(r=>{(r.toLowerCase()===e.toLowerCase()||r.toLowerCase().includes(e.toLowerCase()))&&(n=!0)}),n},I=async(e,n)=>{let t=await b(),r=await ae(),o=t.map(i=>i.name).reduce((i,a)=>`${i}
- ${a}`);for(let i of r){if(e.includes("!recipes ")||e.includes("!video "))return;(i.command===e||e.startsWith(i.command))&&(e.toLowerCase().startsWith("!listranks")&&(i.response+=` 
- ${ie}`),e==="!recipes"&&(i.response+=` 
- ${o}`),n.channel.send(i.response).catch(a=>console.error(a)))}let s=i=>{let a=[];return a=i.map(l=>`${l.command}
`),a.push("!abv"),a};if(e=="!list"){let i=`
**Available Bot Commands**
`,a=s(r),H=`${i}${a}`.replaceAll(",","");n.channel.send(H).catch(K=>console.error(K))}};var ce=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,de=(e,n)=>{let t=-668.962+1262.45*e-776.43*e**2+182.94*e**3,r=-668.962+1262.45*n-776.43*n**2+182.94*n**3,o=.22+.001*t,s=(o*t+r)/(1+o),i=(t-s)/(2.0665-.010665*t),a=Math.round(i*(n/.794)*100)/100;return[Math.round(ce(n)+4.5*a),a]},E=(e,n)=>{let[,t,r]=e.split(" "),[o,s]=[Number(t),Number(r)||.996];if(isNaN(o)||isNaN(s)||o<s||o>1.22||s>1.22||o-s>.165){n.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");return}let[a,l]=de(o,s);n.channel.send(`An OG of ${o.toFixed(3)} and an FG of ${s.toFixed(3)} will make ${l}% ABV and ${a} delle units.`)};var v=require("discord.js");var M=u(require("mongoose")),le=new M.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),y=M.default.models.video||M.default.model("video",le);var N=15,V=(e,n)=>{let t=n.includes("kick")?"kick":"ban";if(!p(e)){e.channel.send("Nice try, but you don't have the power");return}let[,r]=n.split(" ");if(!r){e.channel.send(`You need to specify a user to ${t}.`);return}let o=e.mentions.users.first();if(!o){e.channel.send("User not found.");return}t==="kick"?e.guild?.members.kick(o):e.guild?.members.ban(o),e.channel.send(`${o.tag} has been ${t}ed.`)},me=["@everyone","@here"],p=e=>e.member?.permissionsIn(e.channel.id).has(v.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(v.PermissionsBitField.Flags.ModerateMembers),O=(e,n)=>{let t=e.content,{member:r}=e,o=!1;return me.forEach(s=>{typeof s=="string"?t.toLowerCase().includes(s)&&!p(e)&&(r?.timeout(N*60*1e3),o=!0):s.test(t)&&!p(e)&&(r?.timeout(N*60*1e3),o=!0)}),o},P=async(e,n)=>{if(!p(e)){e.channel.send("Nice try, but you don't have the power");return}let[,t,...r]=e.content.split(/[ ,]+/),o=t.slice(2,t.length-1),s=n(o),i=r.join(" ").trim();s&&s.send(i)},ue=async e=>{let{command:n,response:t}=e,o=await new y({command:n,response:t}).save();return{command:o.command,response:o.response,id:o._id.toString()}},D=async e=>{if(!p(e)){e.channel.send("Nice try, but you don't have the power");return}let[,n]=e.content.split(" "),t=e.attachments.first();if(!t||!n)return e.channel.send("Please provide a video attachment and command name.");let r=t.url,o=`!video ${n}`;return await ue({command:o,response:r})?e.channel.send(`${n} has been successfully added.`):e.channel.send("Something went wrong.")};var _=(e,n,t)=>{let r=t?.roles.cache.filter(i=>i.name.toLowerCase().includes("mead")||i.name.toLowerCase()==="beginner"),o=e.substring(g.length);if(o.toLowerCase().includes("every")||o.toLowerCase().includes("@")){n.channel.send("Nice try. No ping for you.");return}if(B(o)){n.channel.send(`You are in this discord server, but we do not grant you the rank of ${o}`);return}let s=n.guild?.roles.cache.find(i=>(o==="10"&&(o="10 "),o.length===1&&(o+=" "),i.name.toLowerCase()===o.toLowerCase()||i.name.toLowerCase().startsWith(o.toLowerCase())));if(!s){n.channel.send(`The role ${o} is not a valid role.`);return}r?.forEach(i=>t?.roles.remove(i.id)),t?.roles.add(s.id),n.channel.send(`You have been assigned to role "${s.name}"`).catch(i=>console.error(i))};var w=u(require("mongoose")),pe=new w.default.Schema({discordId:{type:String,required:!0},joinedAt:{type:Date,required:!0}}),C=w.default.models.User||w.default.model("User",pe);var j=process.env.NEW_USER_ROLE||"",he=process.env.guildId||"";async function q(e){let n=new Date,t=e.id,o=await new C({discordId:t,joinedAt:n}).save();return e.roles.add(j),{discordId:o.discordId,joinedAt:o.joinedAt,id:o.id}}async function G(){return await C.find({}).then(n=>n.map(t=>({_id:t._id.toString(),discordId:t.discordId,joinedAt:t.joinedAt})))}async function W(e,n){if(e.length===0){console.log("No Users Found");return}let t=new Date().getTime(),o=1e3*60*60*24*7;e.forEach(s=>{t-s.joinedAt.getTime()>o&&(n.guilds.cache.get(he)?.members.cache.find(l=>l.id===s.discordId)?.roles.remove(j),C.deleteOne({_id:s._id}).then(l=>console.log(l)),console.log(`Deleted user with discordId ${s.discordId}`))})}var z=u(require("node-cron"));var fe=/belly.*pickle|pickle.*belly/i,k=async e=>{e.content&&fe.test(e.content)&&(e.channel.send(`${e.member?.user} You've been naughty. Stop that or go to jail. \u{1F46E} \u{1F693}`),await e.delete())};var ge=async()=>await y.find(),Y=async(e,n)=>{let t=await ge(),[,r]=e.split(" ");if(!r)return;let o=r?.toLowerCase()||"",s=t.find(i=>i.command.includes(o));if(s){n.channel.send(s.response);return}else if(r){n.channel.send(`The video ${r} is not a valid video command.`);return}};F.default.config();var{token:Me,clientId:ye,welcomeChannel:we="",botSpamChannel:Ce="",generalChannel:be="",adminChannel:ve=""}=process.env,m=new d.Client({intents:[d.GatewayIntentBits.Guilds,d.GatewayIntentBits.GuildMessages,d.GatewayIntentBits.MessageContent,d.GatewayIntentBits.GuildMembers,d.GatewayIntentBits.GuildPresences]});z.default.schedule("0 2 * * *",async()=>{let e=await G();await W(e,m)});m.login(Me);m.once(d.Events.ClientReady,async e=>{await T(),console.log(`Ready! Logged in as ${e.user.tag}`)});m.on("messageCreate",e=>{if(e.author.bot)return;let n=m.channels.cache.get(ve),t=a=>m.channels.cache.get(a),r=e.content,{member:o}=e,s=a=>r.toLowerCase().startsWith(a);if(s(`<@${ye}>`)&&P(e,t),O(e,n)&&n.send(`
<@&713811216979591282>
User ${o?.user} has been flagged for suspicious activity. They have been timed out for 15min. 
Suspicious content can be viewed here ${e.url}

    `),s("?registervideo"))return D(e);if(s("?kick")||s("?ban"))return V(e,r);if(k(e),s(g))return _(r,e,o);if(s("!recipes")&&U(r,e),s("!video")&&Y(r,e),s("!abv"))return E(r,e);if(s("!flip")){e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}");return}if(s("!bakingsoda")){e.channel.send("Baking soda is not a mead ingredient!!");return}return I(r,e)});m.on("messageUpdate",(e,n)=>k(n));m.on("guildMemberAdd",e=>{q(e).then(t=>console.log(t)),m.channels.cache.get(we).send(`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${Ce}> and run **?rank (rank)** to receive a rank and join your mini mead making community.

Hop on into <#${be}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`)});
