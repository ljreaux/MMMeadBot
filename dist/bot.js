"use strict";var F=Object.create;var k=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var J=(e,o,t,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of H(o))!K.call(e,n)&&n!==t&&k(e,n,{get:()=>o[n],enumerable:!(s=z(o,n))||s.enumerable});return e};var u=(e,o,t)=>(t=e!=null?F(V(e)):{},J(o||!e||!e.__esModule?k(t,"default",{value:e,enumerable:!0}):t,e));var d=require("discord.js"),G=u(require("dotenv"));var x=u(require("mongoose")),R=u(require("dotenv"));R.default.config();var v=process.env.MONGO_URI,c=global.mongoose;async function Q(){if(!v)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(c||(c=global.mongoose={conn:null,promise:null}),c.conn)return c.conn;if(!c.promise){let e={bufferCommands:!1};c.promise=x.default.connect(v,e).then(o=>(console.log("Db connected"),o))}try{c.conn=await c.promise}catch(e){throw c.promise=null,e}return c.conn}var $=Q;var p=u(require("mongoose")),X=new p.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),L=p.default.models.Command||p.default.model("Command",X);var f=u(require("mongoose")),Z=new f.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),A=f.default.models.Recipe||f.default.model("Recipe",Z);var b=async()=>await A.find(),U=async(e,o)=>{let t=await b(),[,s]=e.split(" ");if(!s)return;let n=s?.toLowerCase()||"",i=t.find(r=>r.name===n);if(i){o.channel.send(i.link);return}else if(s){o.channel.send(`The recipe ${s} is not a valid recipe command.`);return}};var ee=["Beginner","10 Meads","20 Meads","25 Meads","30 Meads","40 Meads","50 Meads","75 Meads","100 Meads"],ne=ee.reduce((e,o)=>`${e}
- ${o}`),oe=async()=>await L.find(),h="?rank ",T=e=>{let o=!1;return["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"].forEach(s=>{(s.toLowerCase()===e.toLowerCase()||s.toLowerCase().includes(e.toLowerCase()))&&(o=!0)}),o},S=async(e,o)=>{let t=await b(),s=await oe(),n=t.map(r=>r.name).reduce((r,a)=>`${r}
- ${a}`);for(let r of s){if(e.includes("!recipes "))return;(r.command===e||e.startsWith(r.command))&&(e.toLowerCase().startsWith("!listranks")&&(r.response+=` 
- ${ne}`),e==="!recipes"&&(r.response+=` 
- ${n}`),o.channel.send(r.response).catch(a=>console.error(a)))}let i=r=>{let a=[];return a=r.map(l=>`${l.command}
`),a.push("!abv"),a};if(e=="!list"){let r=`
**Available Bot Commands**
`,a=i(s),W=`${r}${a}`.replaceAll(",","");o.channel.send(W).catch(Y=>console.error(Y))}};var te=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,re=(e,o)=>{let t=-668.962+1262.45*e-776.43*e**2+182.94*e**3,s=-668.962+1262.45*o-776.43*o**2+182.94*o**3,n=.22+.001*t,i=(n*t+s)/(1+n),r=(t-i)/(2.0665-.010665*t),a=Math.round(r*(o/.794)*100)/100;return[Math.round(te(o)+4.5*a),a]},B=(e,o)=>{let[,t,s]=e.split(" "),[n,i]=[Number(t),Number(s)||.996];if(isNaN(n)||isNaN(i)||n<i||n>1.22||i>1.22||n-i>.165){o.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");return}let[a,l]=re(n,i);o.channel.send(`An OG of ${n.toFixed(3)} and an FG of ${i.toFixed(3)} will make ${l}% ABV and ${a} delle units.`)};var C=require("discord.js"),I=15,E=(e,o)=>{let t=o.includes("kick")?"kick":"ban";if(!y(e)){e.channel.send("Nice try, but you don't have the power");return}let[,s]=o.split(" ");if(!s){e.channel.send(`You need to specify a user to ${t}.`);return}let n=e.mentions.users.first();if(!n){e.channel.send("User not found.");return}t==="kick"?e.guild?.members.kick(n):e.guild?.members.ban(n),e.channel.send(`${n.tag} has been ${t}ed.`)},se=["@everyone","@here"],y=e=>e.member?.permissionsIn(e.channel.id).has(C.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(C.PermissionsBitField.Flags.ModerateMembers),N=(e,o)=>{let t=e.content,{member:s}=e,n=!1;return se.forEach(i=>{typeof i=="string"?t.toLowerCase().includes(i)&&!y(e)&&(s?.timeout(I*60*1e3),n=!0):i.test(t)&&!y(e)&&(s?.timeout(I*60*1e3),n=!0)}),n};var O=(e,o,t)=>{let s=t?.roles.cache.filter(r=>r.name.toLowerCase().includes("mead")||r.name.toLowerCase()==="beginner"),n=e.substring(h.length);if(n.toLowerCase().includes("every")||n.toLowerCase().includes("@")){o.channel.send("Nice try. No ping for you.");return}if(T(n)){o.channel.send(`You are in this discord server, but we do not grant you the rank of ${n}`);return}let i=o.guild?.roles.cache.find(r=>(n==="10"&&(n="10 "),n.length===1&&(n+=" "),r.name.toLowerCase()===n.toLowerCase()||r.name.toLowerCase().startsWith(n.toLowerCase())));if(!i){o.channel.send(`The role ${n} is not a valid role.`);return}s?.forEach(r=>t?.roles.remove(r.id)),t?.roles.add(i.id),o.channel.send(`You have been assigned to role "${i.name}"`).catch(r=>console.error(r))};var g=u(require("mongoose")),ie=new g.default.Schema({discordId:{type:String,required:!0},joinedAt:{type:Date,required:!0}}),M=g.default.models.User||g.default.model("User",ie);var D=process.env.NEW_USER_ROLE||"",ae=process.env.guildId||"";async function P(e){let o=new Date,t=e.id,n=await new M({discordId:t,joinedAt:o}).save();return e.roles.add(D),{discordId:n.discordId,joinedAt:n.joinedAt,id:n.id}}async function _(){return await M.find({}).then(o=>o.map(t=>({_id:t._id.toString(),discordId:t.discordId,joinedAt:t.joinedAt})))}async function j(e,o){if(e.length===0){console.log("No Users Found");return}let t=new Date().getTime(),n=1e3*60*60*24*7;e.forEach(i=>{t-i.joinedAt.getTime()>n&&(o.guilds.cache.get(ae)?.members.cache.find(l=>l.id===i.discordId)?.roles.remove(D),M.deleteOne({_id:i._id}).then(l=>console.log(l)),console.log(`Deleted user with discordId ${i.discordId}`))})}var q=u(require("node-cron"));var ce=/belly.*pickle|pickle.*belly/i,w=async e=>{e.content&&ce.test(e.content)&&(e.channel.send(`${e.member?.user} You've been naughty. Stop that or go to jail. \u{1F46E} \u{1F693}`),await e.delete())};G.default.config();var{token:de,welcomeChannel:le="",botSpamChannel:me="",generalChannel:ue="",adminChannel:pe=""}=process.env,m=new d.Client({intents:[d.GatewayIntentBits.Guilds,d.GatewayIntentBits.GuildMessages,d.GatewayIntentBits.MessageContent,d.GatewayIntentBits.GuildMembers,d.GatewayIntentBits.GuildPresences]});q.default.schedule("0 2 * * *",async()=>{let e=await _();await j(e,m)});m.login(de);m.once(d.Events.ClientReady,async e=>{await $(),console.log(`Ready! Logged in as ${e.user.tag}`)});m.on("messageCreate",e=>{if(e.author.bot)return;let o=m.channels.cache.get(pe),t=e.content,{member:s}=e,n=r=>t.toLowerCase().startsWith(r);if(N(e,o)&&o.send(`
<@&713811216979591282>
User ${s?.user} has been flagged for suspicious activity. They have been timed out for 15min. 
Suspicious content can be viewed here ${e.url}

    `),n("?kick")||n("?ban"))return E(e,t);if(n(h))return O(t,e,s);if(n("!recipes")&&U(t,e),n("!abv"))return B(t,e);if(n("!flip")){e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}");return}if(n("!bakingsoda")){e.channel.send("Baking soda is not a mead ingredient!!");return}return w(e),S(t,e)});m.on("messageUpdate",(e,o)=>w(o));m.on("guildMemberAdd",e=>{P(e).then(t=>console.log(t)),m.channels.cache.get(le).send(`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${me}> and run **?rank (rank)** to receive a rank and join your mini mead making community.

Hop on into <#${ue}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`)});
