"use strict";var ie=Object.create;var L=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,le=Object.prototype.hasOwnProperty;var me=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let o of ce(n))!le.call(e,o)&&o!==t&&L(e,o,{get:()=>n[o],enumerable:!(s=ae(n,o))||s.enumerable});return e};var d=(e,n,t)=>(t=e!=null?ie(de(e)):{},me(n||!e||!e.__esModule?L(t,"default",{value:e,enumerable:!0}):t,e));var m=require("discord.js"),re=d(require("dotenv"));var A=d(require("mongoose")),I=d(require("dotenv"));I.default.config();var T=process.env.MONGO_URI,l=global.mongoose;async function pe(){if(!T)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(l||(l=global.mongoose={conn:null,promise:null}),l.conn)return l.conn;if(!l.promise){let e={bufferCommands:!1};l.promise=A.default.connect(T,e).then(n=>(console.log("Db connected"),n))}try{l.conn=await l.promise}catch(e){throw l.promise=null,e}return l.conn}var B=pe;var f=d(require("mongoose")),ue=new f.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),j=f.default.models.Command||f.default.model("Command",ue);var h=d(require("mongoose")),fe=new h.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),E=h.default.models.Recipe||h.default.model("Recipe",fe);var C=async()=>await E.find(),N=async(e,n)=>{let t=await C(),[,s]=e.split(" ");if(!s)return;let o=s?.toLowerCase()||"",r=t.find(i=>i.name===o);if(r){n.channel.send(r.link);return}else if(s){n.channel.send(`The recipe ${s} is not a valid recipe command.`);return}};var he=["Beginner","10 Meads","20 Meads","25 Meads","30 Meads","40 Meads","50 Meads","75 Meads","100 Meads"],ge=he.reduce((e,n)=>`${e}
- ${n}`),be=async()=>await j.find(),V=async(e,n)=>{let t=await C(),s=await be(),o=t.map(i=>i.name).reduce((i,a)=>`${i}
- ${a}`);for(let i of s){if(e.includes("!recipes ")||e.includes("!video "))return;e.startsWith(i.command)&&(e.toLowerCase().startsWith("!listranks")&&(i.response+=` 
- ${ge}`),e==="!recipes"&&(i.response+=` 
- ${o}`),n.channel.send(i.response).catch(a=>console.error(a)))}let r=i=>{let a=i.map(c=>`${c.command}
`);return a.push("!abv"),a};if(e=="!list"){let i=`
**Available Bot Commands**
`,a=r(s),u=`${i}${a}`.replaceAll(",","");return n.channel.send(u).catch(v=>console.error(v))}};var we=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,ye=(e,n)=>{let t=-668.962+1262.45*e-776.43*e**2+182.94*e**3,s=-668.962+1262.45*n-776.43*n**2+182.94*n**3,o=.22+.001*t,r=(o*t+s)/(1+o),i=(t-r)/(2.0665-.010665*t),a=Math.round(i*(n/.794)*100)/100;return[Math.round(we(n)+4.5*a),a]},O=(e,n)=>{let[,t,s]=e.split(" "),[o,r]=[Number(t),Number(s)||.996];if(isNaN(o)||isNaN(r)||o<r||o>1.22||r>1.22||o-r>.165)return n.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");let[a,c]=ye(o,r),u=`An OG of ${o.toFixed(3)} and an FG of ${r.toFixed(3)} will make ${c}% ABV and ${a} delle units.`;return n.channel.send(u)};var x=require("discord.js");var g=d(require("mongoose")),Me=new g.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),b=g.default.models.video||g.default.model("video",Me);var ve=15,Ce=["@everyone","@here"],w=e=>e.member?.permissionsIn(e.channel.id).has(x.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(x.PermissionsBitField.Flags.ModerateMembers),_=(e,n)=>{let t=n.includes("kick")?"kick":"ban";if(!w(e))return e.channel.send("Nice try, but you don't have the power");let[,s]=n.split(" ");if(!s)return e.channel.send(`You need to specify a user to ${t}.`);let o=e.mentions.users.first();return o?(t==="kick"?e.guild?.members.kick(o):e.guild?.members.ban(o),e.channel.send(`${o.tag} has been ${t}ed.`)):e.channel.send("User not found.")},D=e=>{let n=e.content.toLowerCase(),{member:t}=e;if(w(e))return!1;let s=(o,r)=>typeof o=="string"?r.includes(o):o.test(r);for(let o of Ce){let r=s(o,n);if(r)return t?.timeout(ve*60*1e3),r}return!1},P=async(e,n)=>{if(!w(e))return e.channel.send("Nice try, but you don't have the power");let[,t,...s]=e.content.split(/[ ,]+/),o=t.slice(2,t.length-1),r=n(o),i=s.join(" ").trim();r&&r.send(i)},xe=async e=>{let{command:n,response:t}=e,o=await new b({command:n,response:t}).save();return{command:o.command,response:o.response,id:o._id.toString()}},G=async e=>{if(!w(e))return e.channel.send("Nice try, but you don't have the power");let[,n]=e.content.split(" "),t=e.attachments.first();if(!t||!n)return e.channel.send("Please provide a video attachment and command name.");let s=t.url,o=`!video ${n}`;return await xe({command:o,response:s})?e.channel.send(`${n} has been successfully added.`):e.channel.send("Something went wrong.")};var k="?rank ",ke=["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rhythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"],Re=e=>{for(let n of ke)if(n.toLowerCase().includes(e.toLowerCase()))return!0;return!1},Y=(e,n,t)=>{let s=t?.roles.cache.filter(i=>i.name.toLowerCase().includes("mead")||i.name.toLowerCase()==="beginner"),o=e.substring(k.length);if(o.toLowerCase().includes("every")||o.toLowerCase().includes("@"))return n.channel.send("Nice try. No ping for you.");if(Re(o))return n.channel.send(`You are in this discord server, but we do not grant you the rank of ${o}`);let r=n.guild?.roles.cache.find(i=>(o==="10"&&(o="10 "),o.length===1&&(o+=" "),i.name.toLowerCase()===o.toLowerCase()||i.name.toLowerCase().startsWith(o.toLowerCase())));return r?(s?.forEach(i=>t?.roles.remove(i.id)),t?.roles.add(r.id),n.channel.send(`You have been assigned to role "${r.name}"`).catch(i=>console.error(i))):n.channel.send(`The role ${o} is not a valid role.`)};var y=d(require("mongoose")),Se=new y.default.Schema({discordId:{type:String,required:!0},joinedAt:{type:Date,required:!0}}),M=y.default.models.User||y.default.model("User",Se);var q=process.env.NEW_USER_ROLE||"",Ue=process.env.guildId||"";async function F(e){let n=new Date,t=e.id,o=await new M({discordId:t,joinedAt:n}).save();return e.roles.add(q),{discordId:o.discordId,joinedAt:o.joinedAt,id:o.id}}async function W(){return await M.find({}).then(n=>n.map(t=>({_id:t._id.toString(),discordId:t.discordId,joinedAt:t.joinedAt})))}async function H(e,n){if(e.length===0){console.log("No Users Found");return}let t=new Date().getTime(),o=1e3*60*60*24*7;e.forEach(r=>{t-r.joinedAt.getTime()>o&&(n.guilds.cache.get(Ue)?.members.cache.find(c=>c.id===r.discordId)?.roles.remove(q),M.deleteOne({_id:r._id}).then(c=>console.log(c)),console.log(`Deleted user with discordId ${r.discordId}`))})}var $=d(require("node-cron"));var $e=/belly.*pickle|pickle.*belly|pelly|bickle|sbp|s.b.p|belly.*cucumber|cucumber.*belly|tummy.*pickle|pickle.*tummy/i,R=async e=>{if($e.test(e.content))return e.channel.send(`${e.member?.user} You've been naughty. Stop that or go to jail. \u{1F46E} \u{1F693}`),await e.delete()};var Le=async()=>await b.find(),J=async(e,n)=>{let t=await Le(),[,s]=e.split(" ");if(!s)return;let o=s?.toLowerCase()||"",r=t.find(i=>i.command.includes(o));return r?n.channel.send(r.response):n.channel.send(`The video ${s} is not a valid video command.`)};var X=["https://media.discordapp.net/attachments/568934729676488706/1250544810864148530/20240612_151713.jpg?ex=66f1cd1c&is=66f07b9c&hm=3d635d01f15e0522b2549b07d96f7c18e087a9bbb3d9d8782e1b170042eddb5c&=&format=webp&width=924&height=1232","https://media.discordapp.net/attachments/756322400890650635/1287570767675916341/20240922_202600.jpg?ex=66f20738&is=66f0b5b8&hm=a3997db24c2f3cdd6efdc18145b06ad095585b342ad7479ba5f298adeede61f0&=&format=webp&width=576&height=1232","https://cdn.discordapp.com/attachments/795860418056159244/1128472098604580995/20230605_113657.jpg?ex=66f1fd8a&is=66f0ac0a&hm=178a7995ee8333bf9908946a6dde17956a53c0987b506f86e5966a840b3624b2&","https://media.discordapp.net/attachments/568934729676488706/1250544810864148530/20240612_151713.jpg?ex=6722949c&is=6721431c&hm=39b52f65399074f44b7f64d7609fd602baaa5adef90cce23c9eed0525771e320&format=webp&width=924&height=1232&","https://media.discordapp.net/attachments/568934729676488706/1300924513919303843/20241029_214606.jpg?ex=67229bde&is=67214a5e&hm=b9ff518e9bab96d48245661c5c08a74134a8b1697bd4429d84a212dd9819450b&=&format=webp&width=1620&height=1216"],Te=()=>X[Math.floor(Math.random()*X.length)],z=Te;var K=d(require("fs")),Ae="./dv10.txt";var Z=()=>{try{let n=K.default.readFileSync(Ae,"utf-8").split(`
`).map(t=>t.trim()).filter(t=>t.length>0);if(n.length)return n[Math.floor(Math.random()*n.length)];throw Error("No lines found.")}catch(e){return console.error(e),""}};var oe=require("discord.js"),S=d(require("fs")),te=d(require("rss-parser")),Ie=new te.default,{YOUTUBE_XML_URL:Q,youtubeShenanigans:ee,guildId:ne}=process.env;async function U(e){let n="./recentVideo.json";try{if(!Q||!ee||!ne)throw new Error;let s=await(await e.guilds.fetch(ne)).channels.fetch(ee),o=await Ie.parseURL(Q),r=S.default.readFileSync(n),{id:i}=JSON.parse(r.toString()),{id:a,title:c,link:u,author:v}=o.items[0];if(i!==a){S.default.writeFileSync(n,JSON.stringify({id:a}));let se=new oe.EmbedBuilder({title:c,url:u,timestamp:Date.now(),image:{url:`https://img.youtube.com/vi/${a.slice(9)}/maxresdefault.jpg`},author:{name:v,iconURL:"https://yt3.googleusercontent.com/quhem18O3ZxjTxeHYD4B95wluihYXG5bmdUrY-dXD7-XrUwJUndGjpnys9H4lpA-W9Pzco51pkg=s160-c-k-c0x00ffffff-no-rj",url:"https://www.youtube.com/c/ManMadeMead/?sub_confirmation=1"},footer:{text:e.user?.tag||"",iconURL:e.user?.displayAvatarURL()||""}});await s?.send({embeds:[se]})}}catch(t){console.error("Error parsing RSS feed",t);return}}re.default.config();var{token:Be,clientId:je,welcomeChannel:Ee="",botSpamChannel:Ne="",generalChannel:Ve="",adminChannel:Oe=""}=process.env,p=new m.Client({intents:[m.GatewayIntentBits.Guilds,m.GatewayIntentBits.GuildMessages,m.GatewayIntentBits.MessageContent,m.GatewayIntentBits.GuildMembers,m.GatewayIntentBits.GuildPresences]});$.default.schedule("0 2 * * *",async()=>{let e=await W();await H(e,p)});$.default.schedule("*/5 * * * *",async()=>await U(p));p.login(Be);p.once(m.Events.ClientReady,async e=>{await B(),console.log(`Ready! Logged in as ${e.user.tag}`)});p.on("messageCreate",e=>{if(e.author.bot)return;let n=p.channels.cache.get(Oe),t=c=>p.channels.cache.get(c),s=e.content,{member:o}=e,r=c=>s.toLowerCase().startsWith(c);r(`<@${je}>`)&&P(e,t);let i=D(e),a=`
<@&713811216979591282>
User ${o?.user} has been flagged for suspicious activity. They have been timed out for 15min. 
Suspicious content can be viewed here ${e.url}`;return i?n.send(a):r("?registervideo")?G(e):r("?kick")||r("?ban")?_(e,s):(R(e),r("!recipes")&&N(s,e),r("!video")?J(s,e):r("!abv")?O(s,e):r("!flip")?e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}"):r("!bakingsoda")?e.channel.send("Baking soda is not a mead ingredient!!"):r("!avocadohoney")?e.channel.send(z()):r("!dv10")?e.channel.send(Z()):r(k)?Y(s,e,o):V(s,e))});p.on("messageUpdate",(e,n)=>R(n));p.on("guildMemberAdd",e=>{F(e);let n=p.channels.cache.get(Ee),t=`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${Ne}> and run **?rank (rank)** to receive a rank and join your mini mead making community.

Hop on into <#${Ve}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`;n.send(t)});
