"use strict";var U=Object.create;var C=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var q=(e,o,r,s)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of I(o))!Y.call(e,n)&&n!==r&&C(e,n,{get:()=>o[n],enumerable:!(s=G(o,n))||s.enumerable});return e};var u=(e,o,r)=>(r=e!=null?U(W(e)):{},q(o||!e||!e.__esModule?C(r,"default",{value:e,enumerable:!0}):r,e));var d=require("discord.js"),N=u(require("dotenv"));var y=u(require("mongoose")),k=u(require("dotenv"));k.default.config();var b=process.env.MONGO_URI,c=global.mongoose;async function D(){if(!b)throw new Error("Please define the MONGODB_URI environment variable inside .env.local");if(c||(c=global.mongoose={conn:null,promise:null}),c.conn)return c.conn;if(!c.promise){let e={bufferCommands:!1};c.promise=y.default.connect(b,e).then(o=>(console.log("Db connected"),o))}try{c.conn=await c.promise}catch(e){throw c.promise=null,e}return c.conn}var w=D;var p=u(require("mongoose")),z=new p.default.Schema({command:{type:String,required:!0},response:{type:String,required:!0}}),v=p.default.models.Command||p.default.model("Command",z);var h=u(require("mongoose")),F=new h.default.Schema({name:{type:String,required:!0},link:{type:String,required:!0}}),x=h.default.models.Recipe||h.default.model("Recipe",F);var M=async()=>await x.find(),$=async(e,o)=>{let r=await M(),[,s]=e.split(" ");if(!s)return;let n=s?.toLowerCase()||"",a=r.find(t=>t.name===n);if(a){o.channel.send(a.link);return}else if(s){o.channel.send(`The recipe ${s} is not a valid recipe command.`);return}};var V=["Beginner","10 Meads","20 Meads","25 Meads","30 Meads","40 Meads","50 Meads","75 Meads","100 Meads"],_=V.reduce((e,o)=>`${e}
- ${o}`),H=async()=>await v.find(),f="?rank ",L=e=>{let o=!1;return["@everyone","Everyone","@Everyone","everyone","Administrator","Moderator","Mazer of the Week","Patreon Bot","Discord Mead Leader","MMM Patron","Mead Bot","Rythm","Server Booster","EasyPoll","Live Countdown Bot","YouTube Member","technician","YouTube","YT Bot","UMM2024","UMM 2024 Purgatory Member","Commercial"].forEach(s=>{(s.toLowerCase()===e.toLowerCase()||s.toLowerCase().includes(e.toLowerCase()))&&(o=!0)}),o},R=async(e,o)=>{let r=await M(),s=await H(),n=r.map(t=>t.name).reduce((t,i)=>`${t}
- ${i}`);for(let t of s){if(e.includes("!recipes "))return;(t.command===e||e.startsWith(t.command))&&(e.toLowerCase().startsWith("!listranks")&&(t.response+=` 
- ${_}`),e==="!recipes"&&(t.response+=` 
- ${n}`),o.channel.send(t.response).catch(i=>console.error(i)))}let a=t=>{let i=[];return i=t.map(m=>`${m.command}
`),i.push("!abv"),i};if(e=="!list"){let t=`
**Available Bot Commands**
`,i=a(s),O=`${t}${i}`.replaceAll(",","");o.channel.send(O).catch(P=>console.error(P))}};var j=e=>-668.962+1262.45*e-776.43*e**2+182.94*e**3,K=(e,o)=>{let r=-668.962+1262.45*e-776.43*e**2+182.94*e**3,s=-668.962+1262.45*o-776.43*o**2+182.94*o**3,n=.22+.001*r,a=(n*r+s)/(1+n),t=(r-a)/(2.0665-.010665*r),i=Math.round(t*(o/.794)*100)/100;return[Math.round(j(o)+4.5*i),i]},B=(e,o)=>{let[,r,s]=e.split(" "),[n,a]=[Number(r),Number(s)||.996];if(isNaN(n)||isNaN(a)||n<a||n>1.22||a>1.22||n-a>.165){o.channel.send("Please enter a valid number for OG and FG. Example: !abv 1.050 1.010");return}let[i,m]=K(n,a);o.channel.send(`An OG of ${n.toFixed(3)} and an FG of ${a.toFixed(3)} will make ${m}% ABV and ${i} delle units.`)};var g=require("discord.js"),J=15,T=(e,o)=>{let r=o.includes("kick")?"kick":"ban";if(!A(e)){e.channel.send("Nice try, but you don't have the power");return}let[,s]=o.split(" ");if(!s){e.channel.send(`You need to specify a user to ${r}.`);return}let n=e.mentions.users.first();if(!n){e.channel.send("User not found.");return}r==="kick"?e.guild?.members.kick(n):e.guild?.members.ban(n),e.channel.send(`${n.tag} has been ${r}ed.`)},Q=["@everyone","@here"],A=e=>e.member?.permissionsIn(e.channel.id).has(g.PermissionsBitField.Flags.Administrator)||e.member?.permissionsIn(e.channel.id).has(g.PermissionsBitField.Flags.ModerateMembers),S=(e,o)=>{let r=e.content,{member:s}=e,n=!1;return Q.forEach(a=>{r.includes(a)&&!A(e)&&(s?.timeout(J*60*1e3),n=!0)}),n};var E=(e,o,r)=>{let s=r?.roles.cache.filter(t=>t.name.toLowerCase().includes("mead")||t.name.toLowerCase()==="beginner"),n=e.substring(f.length);if(n.toLowerCase().includes("every")||n.toLowerCase().includes("@")){o.channel.send("Nice try. No ping for you.");return}if(L(n)){o.channel.send(`You are in this discord server, but we do not grant you the rank of ${n}`);return}let a=o.guild?.roles.cache.find(t=>(n==="10"&&(n="10 "),n.length===1&&(n+=" "),t.name.toLowerCase()===n.toLowerCase()||t.name.toLowerCase().startsWith(n.toLowerCase())));if(!a){o.channel.send(`The role ${n} is not a valid role.`);return}s?.forEach(t=>r?.roles.remove(t.id)),r?.roles.add(a.id),o.channel.send(`You have been assigned to role "${a.name}"`).catch(t=>console.error(t))};N.default.config();var{token:X,welcomeChannel:Z="",botSpamChannel:ee="",generalChannel:ne="",adminChannel:oe=""}=process.env,l=new d.Client({intents:[d.GatewayIntentBits.Guilds,d.GatewayIntentBits.GuildMessages,d.GatewayIntentBits.MessageContent,d.GatewayIntentBits.GuildMembers,d.GatewayIntentBits.GuildPresences]});l.login(X);l.once(d.Events.ClientReady,async e=>{await w(),console.log(`Ready! Logged in as ${e.user.tag}`)});l.on("messageCreate",e=>{if(e.author.bot)return;let o=l.channels.cache.get(oe),r=e.content,{member:s}=e,n=t=>r.toLowerCase().startsWith(t);if(S(e,o)&&o.send(`
<@&713811216979591282>
User ${s?.user} has been flagged for suspicious activity. They have been timed out for 15min. 
Suspicious content can be viewed here ${e.url}

    `),n("?kick")||n("?ban"))return T(e,r);if(n(f))return E(r,e,s);if(n("!recipes")&&$(r,e),n("!abv"))return B(r,e);if(n("!flip")){e.channel.send("\u{1F6AB} No flips allowed! \u{1F6AB}");return}if(n("!bakingsoda")){e.channel.send("Baking soda is not a mead ingredient!!");return}return R(r,e)});l.on("guildMemberAdd",e=>{l.channels.cache.get(Z).send(`Welcome to the MMM Discord Server <@${e.user.id}>!

 Please head over to <#${ee}> and run **?rank (rank)** to receive a rank and join your mini mead making community.

Hop on into <#${ne}> channel and tell us what you're brewing or plan to brew!

Run **!recipes** to get a list of popular MMM recipes.

You can find a list of all commands by running **!list**`)});
