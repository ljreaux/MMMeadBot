"use strict";var u=Object.create;var r=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var h=(e,o)=>{for(var d in o)r(e,d,{get:o[d],enumerable:!0})},a=(e,o,d,t)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of f(o))!I.call(e,n)&&n!==d&&r(e,n,{get:()=>o[n],enumerable:!(t=g(o,n))||t.enumerable});return e};var w=(e,o,d)=>(d=e!=null?u(p(e)):{},a(o||!e||!e.__esModule?r(d,"default",{value:e,enumerable:!0}):d,e)),U=e=>a(r({},"__esModule",{value:!0}),e);var R={};h(R,{assignTempRole:()=>A,checkRoles:()=>_,getUserRoles:()=>D});module.exports=U(R);var s=w(require("mongoose")),j=new s.default.Schema({discordId:{type:String,required:!0},joinedAt:{type:Date,required:!0}}),c=s.default.models.User||s.default.model("User",j);var m=process.env.NEW_USER_ROLE||"",y=process.env.guildId||"";async function A(e){let o=new Date,d=e.id,n=await new c({discordId:d,joinedAt:o}).save();return e.roles.add(m),{discordId:n.discordId,joinedAt:n.joinedAt,id:n.id}}async function D(){return await c.find({}).then(o=>o.map(d=>({_id:d._id.toString(),discordId:d.discordId,joinedAt:d.joinedAt})))}async function _(e,o){if(e.length===0){console.log("No Users Found");return}let d=new Date().getTime(),n=1e3*60*60*24*7;e.forEach(i=>{d-i.joinedAt.getTime()>n&&(o.guilds.cache.get(y)?.members.cache.find(l=>l.id===i.discordId)?.roles.remove(m),c.deleteOne({_id:i._id}).then(l=>console.log(l)),console.log(`Deleted user with discordId ${i.discordId}`))})}0&&(module.exports={assignTempRole,checkRoles,getUserRoles});
